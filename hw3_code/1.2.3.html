<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seattle Weather Data Visualization</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>

<body>
    <svg width="400" height="400" id="pie-chart"></svg>
    <script>
        var width = 1600;
        var height = 1600;
        var radius = Math.min(width, height) / 2;
        var svg = d3.select('#pie-chart')
                    .attr('width', width)
                    .attr('height', height)
                    .append('g')
                    .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');

        d3.csv("seattle-weather.csv").then(function(data){
            var weatherCounts = data.reduce(function(counts, data) {
                                counts[data.weather] = (counts[data.weather] || 0) + 1;
                                return counts;}, {});
            var totalObservations = Object.values(weatherCounts).reduce(function(sum, count) {
                                    return sum + count;
                                    }, 0);
            var weatherPercentages = {};
            for (var weather in weatherCounts) {
                var count = weatherCounts[weather];
                var percentage = (count / totalObservations * 100).toFixed(2);
                weatherPercentages[weather] = percentage;}
                

            var pie = d3.pie()
                        .value(function(d) { return d.value; });
            
            var pieData = pie(Object.entries(weatherPercentages).map(function([weather, percentage]) {
                        return { weather: weather, value: percentage };
                    }));

            var arcs = svg.selectAll('arc')
            .data(pieData)
            .enter()
            .append('g')
            .attr('class', 'arc');
            
            var outerRadius = width / 4;
            var innerRadius = 0;
            var arc = d3.arc()
            .innerRadius(innerRadius)
            .outerRadius(outerRadius);

            var color = d3.scaleOrdinal(d3.schemeCategory10);

            arcs.append('path')
            .attr('d', arc)
            .attr('fill', function(d, i) { return color(i); });

            arcs.append('text')
            .attr('transform', function(d) { return 'translate(' + arc.centroid(d) + ')'; })
            .attr('text-anchor', 'middle')
            .text(function(d) { return d.data.weather + ' ' + d.data.value + '%'; });
        

        });
    </script>
</body>